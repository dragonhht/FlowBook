<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>申请</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <script th:src="@{/js/jquery-3.2.1.min.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/flow_apply.css}" />
    <script th:src="@{/js/flow_apply.js}" ></script>
</head>
<body>
<!--顶部-->
<div class="top_logo">
        <span class="logo_img">
            <img th:src="@{/img/flowbook1.png}" />
        </span>
    <ul id="top_ul">
        <li>
            <th:block th:if="${session.user eq null}">
                <a th:href="@{/login}" onclick="selectNav(this)">登录</a> |
                <a th:href="@{/register}" onclick="selectNav(this)">注册</a>
            </th:block>
            <th:block th:unless="${session.user eq null}">
                <a th:href="@{/user/userHome}" onclick="selectNav(this)">
                    <span th:text="${session.user.getUserName()}"></span>
                    <img th:if="${session.haveMsg}" style="width: 7px;height: 7px;margin-bottom: 20px;" th:src="@{/img/havemsg.png}" />
                </a>|
                <a th:href="@{/user/logout}" onclick="selectNav(this)">注销</a>
            </th:block>

        </li>
        <li><a href="#" onclick="selectNav(this)">活动</a></li>
        <li><a th:href="@{/notice/{pageNum} (pageNum = 1)}" onclick="selectNav(this)">公告</a></li>
        <li><a th:href="@{/index}" onclick="selectNav(this)" style="color: gray;">首页</a></li>
    </ul>
</div>

<!--页面中部-->
<div class="center_bg">

    <input hidden="hidden" id="userId" th:value="${session.user.userId}" />

    <!--左边内容-->
    <div class="center_left">
        <ul class="nav nav-tabs" id="nav_tabs">
            <li class="active" index="0" onclick="selectTab(this)"><a>他人传阅申请</a></li>
            <li index="1" onclick="selectTab(this)"><a>未回复的他人申请</a></li>
            <li index="2" onclick="selectTab(this)"><a>已回复的他人申请</a></li>
            <li index="3" onclick="selectTab(this)"><a>我的传阅申请</a></li>
        </ul>

        <table id="book_contribution" class="table table-responsive">
            <tr>
                <td>传阅申请编号</td>
                <td>申请图书</td>
                <td>说明</td>
                <td>日期</td>
                <td>状态</td>
                <td>查看</td>
            </tr>
            <tr th:each="allApply : ${allApplies}">
                <td th:text="${allApply.id}"></td>
                <td>
                    <a th:href="@{/tourist/bookMessage/{bookId}(bookId = ${allApply.book.bookId})}" target="_blank" th:text="${allApply.book.bookName}"></a>
                </td>
                <td th:text="${allApply.wantSay}"></td>
                <td th:text="${allApply.applyDate}"></td>
                <th:block th:if="${allApply.status eq 0}">
                    <td>未决定</td>
                </th:block>
                <th:block th:if="${allApply.status eq 1}">
                    <td>同意</td>
                </th:block>
                <th:block th:if="${allApply.status eq 2}">
                    <td>拒绝</td>
                </th:block>
                <th><button th:onclick="'javascript:showApply(\''+${allApply.id}+'\')'" class="btn btn-info">查看</button></th>
            </tr>
        </table>

        <table id="book_now_have" class="table table-responsive" hidden="hidden">
            <tr>
                <td>传阅申请编号</td>
                <td>申请图书</td>
                <td>说明</td>
                <td>日期</td>
                <td>状态</td>
                <td>查看</td>
            </tr>
            <tr th:each="allApply : ${notApplies}">
                <td th:text="${allApply.id}"></td>
                <td>
                    <a th:href="@{/tourist/bookMessage/{bookId}(bookId = ${allApply.book.bookId})}" target="_blank" th:text="${allApply.book.bookName}"></a>
                </td>
                <td th:text="${allApply.wantSay}"></td>
                <td th:text="${allApply.applyDate}"></td>
                <th:block th:if="${allApply.status eq 0}">
                    <td>未决定</td>
                </th:block>
                <th:block th:if="${allApply.status eq 1}">
                    <td>同意</td>
                </th:block>
                <th:block th:if="${allApply.status eq 2}">
                    <td>拒绝</td>
                </th:block>
                <th><button th:onclick="'javascript:showApply(\''+${allApply.id}+'\')'" class="btn btn-info">查看</button></th>
            </tr>
        </table>

        <table id="book_borrow" class="table table-responsive" hidden="hidden">
            <tr>
                <td>传阅申请编号</td>
                <td>申请图书</td>
                <td>说明</td>
                <td>日期</td>
                <td>状态</td>
                <td>查看</td>
            </tr>
            <tr th:each="allApply : ${lookedApplies}">
                <td th:text="${allApply.id}"></td>
                <td>
                    <a th:href="@{/tourist/bookMessage/{bookId}(bookId = ${allApply.book.bookId})}" target="_blank" th:text="${allApply.book.bookName}"></a>
                </td>
                <td th:text="${allApply.wantSay}"></td>
                <td th:text="${allApply.applyDate}"></td>
                <th:block th:if="${allApply.status eq 0}">
                    <td>未决定</td>
                </th:block>
                <th:block th:if="${allApply.status eq 1}">
                    <td>同意</td>
                </th:block>
                <th:block th:if="${allApply.status eq 2}">
                    <td>拒绝</td>
                </th:block>
                <th><button th:onclick="'javascript:showApply(\''+${allApply.id}+'\')'" class="btn btn-info">查看</button></th>
            </tr>
        </table>

        <div id="notice" hidden="hidden">
            <ul class="pagination">
                <li class="active"><a>申请图书退出系统</a></li>
                <li ><a>申请活动显示</a></li>
            </ul>

            <div class="apply_out">
                <form class="form-horizontal" enctype="multipart/form-data" method="post" th:action="@{/user/applyOut}">

                    <div class="form-group" style="margin-left: auto;margin-right: auto;">
                        <label class="col-sm-2 control-label">图书漂流编号：</label>
                        <div class="col-sm-7">
                            <input type="text" name="bookId" id="bookId" class="form-control"  />
                        </div>
                        <div class="col-sm-3" id="select_book">
                            <a index="name" onclick="showUpdateDiv(this)">选择图书</a>
                        </div>
                    </div>
                    <div class="form-group" style="margin-left: auto;margin-right: auto;">
                        <label class="col-sm-2 control-label">图书损坏图片：</label>
                        <div>
                        <span id="addImg" class="book_img_div">
                            <img style="width: 150px;height: 200px;" th:src="@{/img/add_img.png}" />
                            <input name="img" type="file" hidden="hidden" style="display: none" />
                        </span>
                        </div>
                    </div>
                    <div class="form-group upload_btn">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-primary">提交申请</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!--右边内容-->
    <div class="center_right" th:include="assembly::user_right"></div>
</div>

<!--选择图书-->
<div class="update_div" id="update_name" hidden="hidden">
    <span class="update_top"></span>
    <div class="close" onclick="hideUpdateDiv(this)" align="right">x</div>
    <table class="table table-responsive">
        <tr>
            <td>图书编号</td>
            <td>图书名</td>
            <td>出版社</td>
            <td>作者</td>
            <td>选择</td>
        </tr>
        <tr th:each="book : ${canApplyBook}">
            <td th:text="${book.bookId}"></td>
            <td th:text="${book.bookName}"></td>
            <td th:text="${book.publish}"></td>
            <td th:text="${book.author}"></td>
            <td>
                <button th:onclick="'javascript:selectBook(\''+${book.bookId}+'\')'" class="btn btn-info">选择</button>
            </td>
        </tr>
    </table>
</div>

<!--底部-->
<div class="footer" align="center">
    <p class="copyright">
        Copyright © 2017. All Rights Reserved by dragonhht from
        <a href="https://github.com/dragonhht" title="Github" target="_blank" style="color: gray;">dragonhht</a>
    </p>
</div>

<!--选择图片-->
<div class="update_div" id="update_img" hidden="hidden">
    <div class="close" onclick="hideUpdateDiv(this)" align="right">x</div>
    <span class="update_top" id="imgResult"></span>
    <form id="imgForm">
        <div class="form-group form_group" style="margin-left: auto;margin-right: auto;">
            <label class="col-sm-2 control-label">损坏图片：&nbsp;&nbsp;&nbsp;</label>
            <div class="col-sm-7">
                <input type="file" id="uploadImg" name="uploadImg" placeholder="请选择图书封面图片" />
                <input id="imgIndex" hidden="hidden" name="index" value="0" />
                <input id="applyBookId" hidden="hidden" name="bookId" value="0"/>
            </div>
        </div>
        <div class="form-group form_group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="button" id="updateImgBtn" class="btn btn-primary">确定修改</button>
            </div>
        </div>
    </form>
</div>

<!--展示申请-->
<div class="update_div" id="show_apply" hidden="hidden">
    <div class="close" onclick="hideUpdateDiv(this)" align="right">x</div>
    <span class="update_top"></span>
    <div class="form-group">
        <label for="applyText">申请人：</label>
        <a id="applyText" target="_blank"></a>
    </div>
    <div class="form-group">
        <label for="applyForBook">相关书籍编号：</label>
        <a id="applyForBook" target="_blank"></a>
    </div>
    <div class="form-group">
        <label for="applyStatus">状态：</label>
        <span id="applyStatus"></span>
    </div>
    <div class="form-group">
        <label for="applySay">说明：</label>
        <div id="applySay" style="border: 1px solid #DDDDDD; width: 500px;height: 100px;"></div>
    </div>
    <div class="form-group" id="applyBtn">

    </div>
</div>
</body>
</html>